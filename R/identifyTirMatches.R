#' @title Identify Terminal Inverted Repeat Matches
#' @description Searches a DNAStringSet for potential TIRs based on sequence similarity.
#' @param tirMatches A dataframe of previously identified TIRs, in the format generated by \code{\link[GenomicRanges]{makeGRangesFromDataFrame}}.
#' @param subSeq A DNAString object to be searched for.
#' @param Genome A DNAStringSet object containing the DNAString objects to be searched.
#' @param mismatch The allowable mismatch between \code{subSeq} and a given slice of \code{Genome}. Includes indels. See \code{\link[Biostrings]{matchPattern}}.
#' @param strand The directionality of the search string ("+", "-" or "*").
#' @author Jack Gisby
#' @details
#' Called by \code{\link{packSearch}}. Function intended for internal use; for non-internal use, use \code{\link[Biostrings]{matchPattern}}.
#' @return A dataframe, \code{tirMatches}, containing identified matches. Will be appended to \code{tirMatches} if given.

identifyTirMatches <- function(tirMatches = NULL,
                               subSeq,
                               Genome,
                               mismatch = 0,
                               strand = "*") {
  if (is.null(tirMatches)) {
    tirMatches <- data.frame(
      seqnames = character(),
      start = integer(),
      end = integer(),
      width = integer(),
      strand = character()
    )
  }

  for (i in 1:length(Genome)) {
    matches <- Biostrings::matchPattern(subSeq,
      Genome[[i]],
      max.mismatch = mismatch,
      with.indels = TRUE
    )

    if (length(matches) > 0) {
      tirMatches <- rbind(tirMatches, data.frame(
        seqnames = names(Genome)[i],
        start = matches@ranges@start,
        end = matches@ranges@start + matches@ranges@width - 1,
        width = matches@ranges@width,
        strand = strand
      ))
    }
  }

  return(tirMatches)
}
